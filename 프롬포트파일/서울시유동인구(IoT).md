# Sequential Thinking 기반 AI 코드 생성 프롬프트

## 1. 역할(Role)

너는 **데이터 엔지니어**이며,  
반드시 **Sequential Thinking (단계적 사고)** 방식으로 문제를 해결해야 한다.

- 모든 사고 과정은 **단계 번호를 붙여 명확히 구분**
- 반드시 **계획 → 판단 → 코드 작성** 순서를 지킬 것
- 코드만 제시하지 말고, **왜 그렇게 설계했는지 설명 포함**

---

## 2. 프로젝트 배경

- **목표**: 서울시 스마트도시 데이터(S-DoT) 유동인구 데이터를 **원본 그대로 수집**
- **수집 시작 기준일**: **2025년 12월 09일부터** ~ 현재 (실시간/지속적 수집)
- **공간 단위**: **행정동(자치구) 단위**의 데이터 확보
- **시간 단위**: **실시간 원본 (집계 없음)**
- **핵심 변경 사항**: 
  - 기존의 3시간 단위 집계 로직 제거
  - 원본 데이터를 손실 없이 수집하여 저장

---

## 3. 사용 데이터

### 3.1 유동인구 데이터 (OpenAPI)

- API명: **스마트서울 도시데이터 센서(S-DoT) 유동인구 측정 정보**
- 서비스명: `IotVdata018`

#### 엔드포인트
http://openapi.seoul.go.kr:8088/{KEY}/{TYPE}/IotVdata018/{START_INDEX}/{END_INDEX}/

#### 요청 파라미터

| 변수명 | 필수 | 설명 |
|---|---|---|
| KEY | O | OpenAPI 인증키 |
| TYPE | O | json |
| SERVICE | O | IotVdata018 |
| START_INDEX | O | 페이징 시작 번호 |
| END_INDEX | O | 페이징 종료 번호 |

#### 주요 응답 컬럼

- `SENSING_TIME` : 측정시간
- `AUTONOMOUS_DISTRICT` : 자치구
- `ADMINISTRATIVE_DISTRICT` : 행정동
- `VISITOR_COUNT` : 방문자수
- `REG_DTTM` : 등록일

---

## 4. Sequential Thinking 필수 수행 단계

### Step 1. 데이터 수집 범위 및 전략 설정

- 2025년 12월 09일부터의 데이터를 수집하기 위한 전략 수립
- API가 인덱스 기반(`START_INDEX`/`END_INDEX`)이므로, 특정 날짜(2025-12-09)에 해당하는 데이터가 어디서부터 시작하는지 찾거나 필터링하는 방법 설계
- **행정동(자치구)** 정보가 누락되지 않도록 컬럼 확인

### Step 2. 대용량 데이터 처리 및 저장 설계

- 실시간 원본 데이터는 양이 많으므로 효율적인 수집 루프 설계
- 페이징 처리(한 번에 1000건 등) 로직
- 수집 중단 시 이어받기(Resume) 또는 중복 수집 방지 전략 고민

### Step 3. 데이터 필터링 로직 정의

- 수신된 데이터 중 `SENSING_TIME` 또는 `REG_DTTM`을 기준으로 **2025년 12월 09일 00:00:00 이후** 데이터만 남기는 로직
- 불필요한 집계 프로세스 완전 배제 (Raw Data 유지)

### Step 4. 예외 처리 및 안정성 확보

- API 호출 실패 시 재시도(Retry) 로직
- API Key 제한이나 타임아웃에 대한 대응

---

## 5. 코드 작성 요구사항

- 언어: **Python**
- 필수 라이브러리:
  - `requests`
  - `pandas`
  - `datetime`
  - `time` (딜레이용)
- 선택 라이브러리:
  - `tqdm` (진행률 표시)

### 코드 구성

1. **API 호출 함수**: 인덱스 범위를 받아 데이터 가져오기
2. **날짜 필터링 함수**: 2025-12-09 이후 데이터인지 판별
3. **메인 수집 루프**:
   - 인덱스를 증가시키며 반복 호출
   - 데이터가 없거나 날짜 범위를 벗어나면 처리
   - 수집된 데이터를 CSV로 저장 (Append 모드 또는 분할 저장)
4. **결과 저장**: `seoul_floating_pop_raw.csv` (인코딩: utf-8-sig 권장)

> OpenAPI KEY는 `"YOUR_API_KEY"` 형태의 변수로 처리할 것

---

## 6. 출력 결과

- 최종 결과: 지정된 날짜 이후의 모든 원본 행이 포함된 CSV 파일
- 필수 포함 컬럼:
  - `SENSING_TIME`
  - `AUTONOMOUS_DISTRICT` (자치구)
  - `ADMINISTRATIVE_DISTRICT` (행정동)
  - `VISITOR_COUNT`
  - `REG_DTTM`

---

## 7. 중요 규칙

- **집계 하지 말 것**: 3시간 단위 등으로 묶지 말고, API에서 주는 row 단위 그대로 저장
- **명확한 로직 설명**: 날짜를 어떻게 필터링했는지, 루프는 언제 멈추는지 설명
- **안정성**: 장시간 수집 시 메모리 문제 등을 고려하여 중간중간 파일에 기록하는 것을 권장

---

## 8. 최종 요청

위 요구사항을 모두 만족하도록  
**단계적 사고 기반 분석 + 실행 가능한 Python 코드**를 작성하라.
